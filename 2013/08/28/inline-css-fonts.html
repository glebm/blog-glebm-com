<!DOCTYPE html>
<html><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/images/favicon.ico" rel="icon" type="image/ico" /><link href="http://blog.glebm.com/feed.xml" rel="alternate" title="Gleb's Notes Feed" type="application/atom+xml" /><title>Inline CSS web fonts on Gleb's Notes</title><link href="/stylesheets/application.css?1407186035" rel="stylesheet" type="text/css" /><link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" /><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script><script src="/javascripts/application.js?1407186037" type="text/javascript"></script>
</head><body><script type="text/javascript">      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-43451052-1', 'blog.glebm.com');
      ga('send', 'pageview');
</script><header class="navbar navbar-default"><div class="container"><div class="navbar-header"><div class="navbar-brand"><a href="/">Gleb's Notes</a></div></div><ul class="nav navbar-nav"><li><a href="/">Index</a></li></ul></div></header><div class="container"><div class="row"><div class="col-md-9 col-lg-9"><div class=" " id="main" role="main"><div class="article"><div class="article-header"><h1 class="article-title"><a href="http://blog.glebm.com/2013/08/28/inline-css-fonts.html">Inline CSS web fonts</a></h1><div class="article-date"><span class='date'> <span class='day'>28</span> <span class='month'>Aug</span> <span class='year'> 2013 </span> </span></div></div><div class="article-body"><p>If you serve web fonts via URL, the browser makes a separate request for every web font.</p>

<p>This is what the timeline looks like for a URL referenced font:</p>

<p><img class="img-responsive" alt="" width="469" height="281" src="http://blog.glebm.com/images/2013-08-28-inline-css-fonts/tl-body.png?1407186036" /></p>

<h4 class="text-center">
  <span style="color: rgba(0, 0, 255, 0.67)">Ready</span> <span style="color: rgba(255, 0, 0, 0.78)">Load</span>
</h4>

<p>Fonts included from stylesheets cause extra requests that only starts once the DOM has loaded.
This causes a delay and flash of missing text or a font change flash while the fonts are loading.</p>

<p>However, you can avoid extra requests <em>and</em> rendering issues if you inline the fonts as data-uris.</p>

<p></p>

<p>Inline web fonts with this script:</p>

<pre><code class="highlight shell"><span class="c"># download inliner and mark it as executable</span>
curl https://gist.github.com/glebm/6360088/raw &gt; inline-fonts.rb; chmod +x inline-fonts.rb
<span class="c"># provide URL or path to convert</span>
./inline-fonts.rb <span class="s1">'https://fonts.googleapis.com/css?family=Arimo:400'</span>
</code></pre>

<p><a href="https://gist.github.com/glebm/6360088">The script</a> outputs CSS with all the <code>url</code> values inlined in data-uris, <code>woff</code> format.
You can now deliver the fonts and CSS together in 1 request and the rendering is perfect, 
no more <a href="http://en.wikipedia.org/wiki/Flash_of_unstyled_content"><def title="Flash of Unstyled Content">FOUC</def></a> or font change.</p>

<h3 id="there-be-dragons">There be dragons</h3>

<ul>
  <li>base64 encoding causes a +33% file size increase, but gzip mitigates this</li>
  <li>when there are more fonts files at some point it is faster to download them in parallel, depending on the font sizes and latency / bandwidth of the audience.</li>
  <li>public CDN files may already be in browser cache (e.g. the most popular Google Web Fonts)</li>
  <li>the most common format woff is <a href="http://caniuse.com/woff">supported</a> everywhere but IE 8, stock Anroid Browser,
and Chrome on Windows, which has a <a href="https://code.google.com/p/chromium/issues/detail?id=137692">general rendering issue</a> with some fonts, and base64 <a href="http://www.mobify.com/blog/data-uris-are-slow-on-mobile/">is slow on Android 2 and iOS 5</a>.
You will have to serve other formats to these browsers</li>
</ul>

<p>Most individual font sizes are in 10 - 20 KB range; if you only use a few font files this could easily cut down initial load times by 5-20%.
Measure with any client-side monitoring tool to find out (it is best if your tool shows the distribution, and not just the average).</p>

<p>This is what the timeline looks like once the fonts are inlined:</p>

<p><img class="img-responsive" alt="" width="642" height="453" src="http://blog.glebm.com/images/2013-08-28-inline-css-fonts/tl-inline.png?1407186036" /></p>

<p>When inlined, all the fonts are finished downloading before DOMContentReady fires.</p>

<p>Alternatively, you could try using <a href="https://developers.google.com/speed/pagespeed/module">Google Page Speed Module</a>, which may intellegently apply this and other optimizations, but has it's own drawbacks.
<a href="http://en.wikipedia.org/wiki/SPDY">SPDY</a> should already be on for both timelines.</p>

<h4 id="see-also">See also</h4>

<ul>
  <li><a href="https://news.ycombinator.com/item?id=6304999">Discussion on Hacker News</a></li>
</ul>

</div></div><div class="article-social"><h4>Share on</h4><ul><li><a class="social" href="https://twitter.com/share?text=Inline%20CSS%20web%20fonts&url=http%3A%2F%2Fblog.glebm.com%2F2013%2F08%2F28%2Finline-css-fonts.html" target="_blank"><i class='fa fa-twitter fa-inline'></i></a></li><li><a class="social" href="https://www.linkedin.com/cws/share?url=http%3A%2F%2Fblog.glebm.com%2F2013%2F08%2F28%2Finline-css-fonts.html" target="_blank"><i class='fa fa-linkedin fa-inline'></i></a></li><li><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fblog.glebm.com%2F2013%2F08%2F28%2Finline-css-fonts.html" target="_blank"><i class='fa fa-facebook fa-inline'></i></a></li><li><a class="social" href="https://plus.google.com/share?url=http%3A%2F%2Fblog.glebm.com%2F2013%2F08%2F28%2Finline-css-fonts.html" target="_blank"><i class='fa fa-google-plus fa-inline'></i></a></li></ul></div><div class="comments">    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = "blog-glebm";
var disqus_identifier = "inline-css-fonts";
var disqus_title = "Inline CSS web fonts";
var disqus_url = "http://blog.glebm.com/2013/08/28/inline-css-fonts.html";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div></div></div><div class="col-md-3"><aside class="sidebar"><div class="text-center"><div class="person-img"><img class="img-responsive img-circle" alt="" width="400" height="400" src='http://blog.glebm.com/images/author.jpg?1407186036' /></div><p><abbr title="Gleb Mazovetskiy">@glebm</abbr></p><p><ul class="nav nav-pills nav-justified"><li><a href="https://twitter.com/glebm" rel="me"><i class='fa fa-twitter'></i> Twitter</a></li><li><a href="https://github.com/glebm" rel="me"><i class='fa fa-github'></i> Github</a></li></ul></p></div><hr /><h3>Posts</h3><ul class="nav nav-pills nav-stacked"><li><a href="http://blog.glebm.com/2014/02/27/i18n-made-easier-with-static-analysis.html">Internationalization made easier with static analysis</a></li><li><a href="http://blog.glebm.com/2013/08/31/redis-compressed-lists.html">Save Redis memory with large list packing</a></li><li class="active"><a href="http://blog.glebm.com/2013/08/28/inline-css-fonts.html">Inline CSS web fonts</a></li><li><a href="http://blog.glebm.com/2013/08/23/screenshots-in-git.html">Store screenshots of your web app in Git</a></li></ul><hr /><ul class="nav nav-stacked text-left nav-pills"><li><a href="http://blog.glebm.com/feed.xml"><i class='fa fa-rss fa-fw'></i> Atom Feed</a></li><li><a href="https://github.com/glebm/blog-glebm-com"><i class='fa fa-code-fork fa-fw'></i> This blog on Github</a></li></ul><hr /><h3>Open Source</h3><div class="list-group"><a class="list-group-item" href="https://github.com/twbs/bootstrap-sass"><h4 class="list-group-item-heading">Bootstrap for Sass</h4><p class="list-group-item-text">Port of Twitter Bootstrap web framework to Sass language, automatically generated from the LESS version.</p></a><a class="list-group-item" href="https://github.com/glebm/i18n-tasks"><h4 class="list-group-item-heading">i118n-tasks</h4><p class="list-group-item-text">Manage translation and localization with static analysis, for Ruby i18n.</p></a><a class="list-group-item" href="https://github.com/glebm/order_query"><h4 class="list-group-item-heading">order_query</h4><p class="list-group-item-text">ActiveRecord ORM extension to find next or previous records relative to the current one efficiently.</p></a></div></aside></div></div></div><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></script></body></html>