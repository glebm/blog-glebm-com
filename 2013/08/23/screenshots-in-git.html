<!DOCTYPE html>
<html><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/images/favicon.ico" rel="icon" type="image/ico" /><link href="http://blog.glebm.com/feed.xml" rel="alternate" title="Gleb's Notes Feed" type="application/atom+xml" /><title>Store screenshots of your web app in Git on Gleb's Notes</title><link href="/stylesheets/application.css?1393496345" media="screen" rel="stylesheet" type="text/css" /><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script><script src="/javascripts/application.js?1393492259" type="text/javascript"></script>
</head><body><script type="text/javascript">      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-43451052-1', 'glebm.com');
      ga('send', 'pageview');
</script><header class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle" data-target=".bs-navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-brand"><a href="/">Gleb's Notes</a></div></div><nav class="collapse navbar-collapse bs-navbar-collapse nav-default"><ul class="nav navbar-nav"><li><a href="/">Index</a></li></ul></nav></div></header><div class="container"><div class="row"><div class="col-md-9 col-lg-9"><div id="main" role="main"><div class="article-layout"><article class="blog-article"><div class="article-date"><span class='date'> <span class='day'>23</span> <span class='month'>Aug</span> <span class='year'> 2013 </span> </span></div><h1>Store screenshots of your web app in Git</h1><div class="article-body"><p>Have you ever had a change break your site? Even when the tests pass?</p>

<ul>
  <li>Testing functionality is hard</li>
  <li>Testing UI is even harder</li>
</ul>

<p>What if every time you commit, you got a visual diff of every web page that changed?
It is surprisingly easy to do.</p>

<p><img class="img-responsive" alt="" width="828" height="296" src="http://blog.glebm.com/images/2013-08-23-screenshots-in-git/gh-img-diff-1.png?1393496341" /></p>

<p></p>

<h3 id="how">How?</h3>
<p>All we need is a headless browser and a testing environment.</p>

<p>For Rails you can use poltergeist + rspec and <a href="https://github.com/glebm/rails_email_preview/blob/master/spec/support/save_screenshots.rb">just</a> do <a href="https://github.com/glebm/rails_email_preview/blob/master/spec/features/take_screenshots_spec.rb">this</a> like in the tests for my <a href="https://github.com/glebm/rails_email_preview">Rails Email Preview</a> gem. You then simply list the shots you want:</p>

<pre class="highlight ruby"><span class="n">describe</span> <span class="s1">&#39;Take screenshots&#39;</span><span class="p">,</span> <span class="ss">driver: :poltergeist</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">&#39;home page&#39;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s1">&#39;/&#39;</span>
    <span class="n">screenshot!</span> <span class="s1">&#39;home&#39;</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;user account page&#39;</span> <span class="k">do</span>
    <span class="n">sign_in</span> <span class="no">Fabricate</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
    <span class="n">visit</span> <span class="n">my_account_url</span>
    <span class="n">screenshot!</span> <span class="s1">&#39;my-account&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>The code will simply place screenshots into <code>spec/screenshots</code>  each time the test suite is run.</p>

<p>Once you add <code>spec/screenshots</code> to git, things get interesting.</p>

<h3 id="perks-unlocked">Perks unlocked</h3>
<p>With your screenshots under version control, you will</p>

<ul>
  <li>Always know when you introduce a change that changes the display</li>
  <li>See which commits changed screens in your app</li>
  <li>Instantly see what your app looked like at any point in time</li>
</ul>

<p>You must use <code>git submodule add {separate repo URL} spec/screenshots</code> to keep screenshots in a separate repo, as it will get large.
You can also script rewriting images out of older commits via <code>git filter-branch</code> if repo grows too large.</p>

<p>Below is an image diff as <a href="https://github.com/glebm/rails_email_preview/commit/b6b003bf3a49ecf36d51ecf39dcd57e42e259dad?&amp;diff-1=1-82#L14R3">rendered by Github</a>. This is <em>visual version history</em> and your private <em>git wayback machine</em>.</p>

<p><a href="https://github.com/glebm/rails_email_preview/commit/b6b003bf3a49ecf36d51ecf39dcd57e42e259dad?&amp;diff-1=1-82#L14R3"><img class="img-responsive" alt="" width="828" height="432" src="http://blog.glebm.com/images/2013-08-23-screenshots-in-git/gh-img-diff-2.png?1393496341" /></a></p>

<p>I hope this post has helped you. Please let me know if you already do this, as I'm curious to hear other approaches.</p>

<p>â€“ <a href="https://twitter.com/glebm">@glebm</a> </p>

<p><em>Thanks <a href="https://twitter.com/ddtrejo">@ddtrejo</a> for your edits and suggestions!</em></p>

<h4 id="see-also">See also</h4>

<ul>
  <li><a href="https://news.ycombinator.com/item?id=6266490">Discussion on Hacker News</a> - some nice ideas around this approach.</li>
  <li><a href="https://github.com/facebook/huxley/">Huxley</a> - implementation of screenshot control in Selenium and written in Python. <em>Thanks <a href="https://github.com/petehunt">@petehunt</a></em></li>
</ul>

</div><div class="article-footer"><div class="permalink"><label class="form-label text-muted" for="permalink-input">permalink </label><input class="input-sm form-control select-text-on-click" id="permalink-input" type="text" value="http://blog.glebm.com/2013/08/23/screenshots-in-git.html" /></div><div class="twtr-share"><a class="twitter-share-button" data-lang="en" data-size="large" data-url="http://blog.glebm.com/2013/08/23/screenshots-in-git.html" data-via="glebm" href="https://twitter.com/share">Tweet</a></div><div class="suggest-edit"><a class="btn btn-default btn-sm" href="https://github.com/glebm/blog-glebm-com/blob/master/source/2013-08-23-screenshots-in-git.html.markdown.erb"><i class='glyphicon glyphicon-edit'></i> Suggest edit</a></div></div></article><div class="comments">    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = "blog-glebm";
var disqus_identifier = "screenshots-in-git";
var disqus_title = "Store screenshots of your web app in Git";
var disqus_url = "http://blog.glebm.com/2013/08/23/screenshots-in-git.html";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div></div></div></div><div class="col-md-3"><aside class="sidebar"><div class="row"><div class="col-xs-12 col-sm-6 col-md-12"><div class="person-img"><img alt="" width="400" height="400" src='http://blog.glebm.com/images/author.jpg?1393496341' /></div><ul class="list-unstyled"><li><abbr title="Gleb Mazovetskiy">@glebm</abbr></li><li><a rel="me" href="https://twitter.com/glebm">Twitter</a></li><li><a rel="me" href="https://github.com/glebm">Github</a></li></ul></div><div class="col-xs-12 col-sm-6 col-md-12"><h3>Articles</h3><ol class="list-unstyled"><li><a href="/2014/02/27/i18n-made-easier-with-static-analysis.html">i18n made easier with static analysis</a> <div class="badge">Feb 27</div></li><li><a href="/2013/10/21/exploring-math-without-a-teacher.html">Exploring math without a teacher?</a> <div class="badge">Oct 21</div></li><li><a href="/2013/08/31/redis-compressed-lists.html">Save Redis memory with large list packing</a> <div class="badge">Aug 31</div></li><li><a href="/2013/08/28/inline-css-fonts.html">Inline CSS web fonts</a> <div class="badge">Aug 28</div></li><li><a href="/2013/08/23/screenshots-in-git.html">Store screenshots of your web app in Git</a> <div class="badge">Aug 23</div></li></ol><h3>Tags</h3><ol class="list-unstyled"><li><a href="/tags/testing.html">testing</a> <div class="badge">1</div></li><li><a href="/tags/git.html">git</a> <div class="badge">1</div></li><li><a href="/tags/phantomjs.html">phantomjs</a> <div class="badge">1</div></li><li><a href="/tags/ruby.html">ruby</a> <div class="badge">3</div></li><li><a href="/tags/performance.html">performance</a> <div class="badge">2</div></li><li><a href="/tags/webfonts.html">webfonts</a> <div class="badge">1</div></li><li><a href="/tags/css.html">css</a> <div class="badge">1</div></li><li><a href="/tags/redis.html">redis</a> <div class="badge">1</div></li><li><a href="/tags/math.html">math</a> <div class="badge">1</div></li><li><a href="/tags/i18n.html">i18n</a> <div class="badge">1</div></li></ol><hr /><ul class="list-unstyled"><li><a href="http://blog.glebm.com/feed.xml">Feed</a></li><li><a href="https://github.com/glebm/blog-glebm-com">This blog on Github</a></li></ul></div></div></aside></div></div></div><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></script></body></html>